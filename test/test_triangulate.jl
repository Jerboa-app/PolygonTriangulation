using PolygonTriangulation
using Test

@testset "Triangulation" begin

    P = Polygon(
        [
            Vertex(0.0,0.0),
            Vertex(0.0,1.0),
            Vertex(1.0,0.0),
            Vertex(0.5,0.5)
        ]
    );

    @test triangulate(P) == [[P.vertices[4],P.vertices[1],P.vertices[2]],[P.vertices[2],P.vertices[3],P.vertices[4]]]

    P = Polygon(
        [
            Vertex(0.0,0.0),
            Vertex(0.33,1.25),
            Vertex(0.575,0.75),
            Vertex(1.,1.)
        ]
    )

    @test triangulate(P) == [
                        [Vertex(0.0, 0.0), Vertex(0.33, 1.25), Vertex(0.575, 0.75)],
                        [Vertex(0.0, 0.0), Vertex(0.575, 0.75), Vertex(1.0, 1.0)]
                      ]

    # following highlighted now fixed issues in geometry code (bisectors, intersections, point in triangle etc)

    P = Polygon(
                [
                 Vertex(1.1916655596791519, -0.49360403663203056)
                 Vertex(0.9575527878348344, 0.9575527878348342)
                 Vertex(1.1568622657126908, 0.47918804025586376)
                 Vertex(1.4828907275871481, 0.0)
                ]
    );


    @test triangulate(P) == [
            [Vertex(1.1916655596791519, -0.49360403663203056), Vertex(0.9575527878348344, 0.9575527878348342), Vertex(1.1568622657126908, 0.47918804025586376)],
            [Vertex(1.1916655596791519, -0.49360403663203056), Vertex(1.1568622657126908, 0.47918804025586376), Vertex(1.4828907275871481, 0.0)]
        ]

    # issue was with bisect

    P = Polygon(
        [
             Vertex(0.8132948280184534, -0.8132948280184539)
             Vertex(-3.270279837139837e-16, -1.7802574257419816)
             Vertex(6.866800612668364e-17, 1.1214336439615566)
             Vertex(1.744515205699094, 0.0)
        ]
    )

    @test triangulate(P) == [
        [Vertex(0.8132948280184534, -0.8132948280184539), Vertex(-3.270279837139837e-16, -1.7802574257419816), Vertex(6.866800612668364e-17, 1.1214336439615566)],
        [Vertex(0.8132948280184534, -0.8132948280184539), Vertex(6.866800612668364e-17, 1.1214336439615566), Vertex(1.744515205699094, 0.0)]
    ]

    # issue was with indices after subdividing still being used on original polygon
    P=Polygon([
         Vertex(1.1494350826676496, -0.6636266543941667)
         Vertex(0.7430056012610196, -1.2869234516923478)
         Vertex(-1.8592280331185806e-16, -1.0121166007010063)
         Vertex(-0.7741261170360401, -1.340825766172431)
         Vertex(-1.0896768384226028, -0.629125215992989)
         Vertex(-1.4417214501323887, 8.1681289552985e-16)
         Vertex(-1.4380128799418335, 0.8302371233325673)
         Vertex(-0.9938852890028477, 1.7214598174482103)
         Vertex(1.6383865992203976, 0.0)
    ])

    @test triangulate(P) == [
        [Vertex(1.1494350826676496, -0.6636266543941667), Vertex(0.7430056012610196, -1.2869234516923478), Vertex(-1.8592280331185806e-16, -1.0121166007010063)],
        [Vertex(1.6383865992203976, 0.0), Vertex(1.1494350826676496, -0.6636266543941667), Vertex(-1.8592280331185806e-16, -1.0121166007010063)],
        [Vertex(1.6383865992203976, 0.0), Vertex(-1.8592280331185806e-16, -1.0121166007010063), Vertex(-0.7741261170360401, -1.340825766172431)],
        [Vertex(1.6383865992203976, 0.0), Vertex(-0.7741261170360401, -1.340825766172431), Vertex(-1.0896768384226028, -0.629125215992989)],
        [Vertex(1.6383865992203976, 0.0), Vertex(-1.0896768384226028, -0.629125215992989), Vertex(-1.4417214501323887, 8.1681289552985e-16)],
        [Vertex(1.6383865992203976, 0.0), Vertex(-1.4417214501323887, 8.1681289552985e-16), Vertex(-1.4380128799418335, 0.8302371233325673)],
        [Vertex(-1.4380128799418335, 0.8302371233325673), Vertex(-0.9938852890028477, 1.7214598174482103), Vertex(1.6383865992203976, 0.0)],
]
    # issue was not relabeling polygon but using subpolygons

    P = Polygon(
            [Vertex(1.118810705213808, -0.4634265678277647)
             Vertex(1.3197032114152834, -1.3197032114152816)
             Vertex(-0.5802516365367526, -1.4008513705162096)
             Vertex(-1.5522320115836232, -1.5522320115836228)
             Vertex(-1.1882311199748008, 1.4551634377244145e-16)
             Vertex(-1.118190867085786, 2.6995515566402357)
             Vertex(0.969831828211908, 2.3413811528902815)]
    )

    @test triangulate(P) == [
         [Vertex(1.118810705213808, -0.4634265678277647), Vertex(1.3197032114152834, -1.3197032114152816), Vertex(-0.5802516365367526, -1.4008513705162096)],
         [Vertex(0.969831828211908, 2.3413811528902815), Vertex(1.118810705213808, -0.4634265678277647), Vertex(-0.5802516365367526, -1.4008513705162096)],
         [Vertex(0.969831828211908, 2.3413811528902815), Vertex(-0.5802516365367526, -1.4008513705162096), Vertex(-1.5522320115836232, -1.5522320115836228)],
         [Vertex(0.969831828211908, 2.3413811528902815), Vertex(-1.5522320115836232, -1.5522320115836228), Vertex(-1.1882311199748008, 1.4551634377244145e-16)],
         [Vertex(-1.1882311199748008, 1.4551634377244145e-16), Vertex(-1.118190867085786, 2.6995515566402357), Vertex(0.969831828211908, 2.3413811528902815)],
     ]
end

@testset "Given a Left handed Polygon" begin

        v = [Vertex(1.0018487477025975, 0.0)
     Vertex(1.0410841583029593, 0.7563919162397653)
     Vertex(-0.32112791516681294, -0.9883300978363111)
     Vertex(1.206290630536759, -0.8764214442193581)]

    P = Polygon(v)

    @test triangulate(P) == [
        [Vertex(1.0018487477025975, 0.0), Vertex(1.206290630536759, -0.8764214442193581), Vertex(-0.32112791516681294, -0.9883300978363111)],
        [Vertex(-0.32112791516681294, -0.9883300978363111), Vertex(1.0410841583029593, 0.7563919162397653), Vertex(1.0018487477025975, 0.0)]
        ]

end
